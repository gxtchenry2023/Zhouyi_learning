
<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>å‘¨æ˜“64å¦ Â· é€‰æ‹©é¢˜ï¼ˆå…­çˆ»å¦å½¢ç‰ˆï¼‰</title>
  <style>
    :root{--bg:#0f1115;--panel:#161a22;--muted:#8b93a7;--text:#eef2ff;--accent:#6aa1ff;--right:#2ecc71;--wrong:#ff5c5c;--btn:#20283a;--btn-border:#2b3550;--line:#e8edff}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",Arial,sans-serif;background:#0f1115;color:var(--text)}
    .wrap{max-width:960px;margin:40px auto;padding:24px}
    .card{background:var(--panel);border:1px solid #202533;border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{margin:0 0 8px;font-size:24px}
    p.desc{margin:0 0 18px;color:var(--muted);font-size:14px}
    .controls{display:grid;grid-template-columns:1.1fr 1fr 1fr;gap:12px;margin:14px 0 12px}
    @media (max-width:720px){.controls{grid-template-columns:1fr}}
    select,button{width:100%;padding:12px 14px;border-radius:12px;background:var(--btn);color:var(--text);border:1px solid var(--btn-border);font-size:15px;-webkit-tap-highlight-color:transparent}
    button.primary{background:var(--accent);color:#0b1020;border:0;font-weight:600;cursor:pointer}
    .row{display:flex;gap:14px;align-items:center;flex-wrap:wrap;margin:0 0 10px}
    .toggle{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:14px}
    .toggle input{appearance:none;width:42px;height:24px;border-radius:999px;background:#2b3550;position:relative;outline:none;border:1px solid #394465}
    .toggle input:checked{background:#6aa1ff}
    .toggle input::after{content:"";position:absolute;top:2px;left:2px;width:18px;height:18px;background:#0f1115;border-radius:50%;transition:left .2s}
    .toggle input:checked::after{left:22px}

    .qbox{padding:16px;border:1px dashed #2b3550;border-radius:12px;margin:10px 0 16px;background:#121722}
    .prompt{font-size:18px;line-height:1.6}
    .options{display:grid;gap:10px;margin:12px 0}
    .opt{padding:12px 14px;border-radius:12px;background:var(--btn);border:1px solid var(--btn-border);text-align:left}
    .opt.correct{border-color:var(--right);background:rgba(46,204,113,.1)}
    .opt.incorrect{border-color:var(--wrong);background:rgba(255,92,92,.08)}

    .progress{height:8px;background:#1b2130;border-radius:999px;overflow:hidden;margin:8px 0 16px;border:1px solid #28314a}
    .bar{height:100%;width:0;background:linear-gradient(90deg,#6aa1ff,#8b9dff)}
    .stats{display:flex;gap:12px;color:var(--muted);font-size:14px;flex-wrap:wrap}
    .pill{padding:2px 8px;border:1px solid #2b3550;border-radius:999px}

    .result{display:none;margin-top:14px;padding:14px;border-radius:12px;background:#121722;border:1px solid #28314a}
    .footer{margin-top:18px;display:flex;gap:10px;flex-wrap:wrap}
    .hint{font-size:13px;color:var(--muted)}

    /* å…­çˆ»å¦å½¢ */
    .hexwrap{display:flex;align-items:center;gap:12px;margin-top:8px;flex-wrap:wrap}
    .hex{width:160px;max-width:48vw}
    .hex .line{display:flex;align-items:center;height:12px;margin:8px 0}
    .hex .yang::before{content:"";height:4px;background:var(--line);border-radius:3px;flex:1}
    .hex .yin{gap:14px}
    .hex .yin::before,.hex .yin::after{content:"";height:4px;background:var(--line);border-radius:3px;width:44%}
    .hexlabel{color:#c7cff2;font-size:13px}
    .sym{font-size:20px;letter-spacing:2px;margin-left:4px;color:#c7cff2}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>å‘¨æ˜“ 64 å¦ Â· é€‰æ‹©é¢˜ï¼ˆå…­çˆ»å¦å½¢ç‰ˆï¼‰</h1>
      <p class="desc">å¯æ˜¾ç¤ºâ€œä¸Šä¸‹å¦å åŠ â€çš„å…­çˆ»å¦å½¢ã€‚æç¤ºï¼šåœ¨â€œå¦å â†’ é€‰ä¸Š/ä¸‹å¦â€æ¨¡å¼ä¸‹ï¼Œé¢˜å¹²æ˜¾ç¤ºå¦å½¢ç­‰äºç›´æ¥æç¤ºç­”æ¡ˆï¼Œå»ºè®®ä»…åœ¨ç­”é¢˜åæ˜¾ç¤ºã€‚</p>

      <div class="controls">
        <select id="mode">
          <option value="name2pair">æ¨¡å¼Aï¼šå¦å â†’ é€‰ä¸Š/ä¸‹å¦</option>
          <option value="pair2name" selected>æ¨¡å¼Bï¼šä¸Š/ä¸‹å¦ â†’ é€‰å¦å</option>
          <option value="mixed">æ¨¡å¼Cï¼šæ··åˆ</option>
        </select>
        <select id="count">
          <option>10</option><option>15</option><option>20</option><option>32</option><option selected>64</option>
        </select>
        <button id="start" class="primary" type="button" onclick="window._forceStart && window._forceStart()">å¼€å§‹æµ‹éªŒ</button>
      </div>

      <div class="row">
        <label class="toggle"><input id="hexInPrompt" type="checkbox">é¢˜å¹²æ˜¾ç¤ºå¦å½¢ï¼ˆä»…å¯¹â€œä¸Š/ä¸‹å¦â†’å¦åâ€ç”Ÿæ•ˆï¼‰</label>
        <label class="toggle"><input id="hexAfter" type="checkbox" checked>ç­”é¢˜åæ˜¾ç¤ºå¦å½¢</label>
      </div>

      <div class="progress"><div id="bar" class="bar"></div></div>
      <div class="stats">
        <div class="pill">è¿›åº¦ï¼š<span id="prog">0/0</span></div>
        <div class="pill">å¾—åˆ†ï¼š<span id="score">0</span></div>
        <div class="pill">æ­£ç¡®ç‡ï¼š<span id="acc">0%</span></div>
      </div>

      <div id="qbox" class="qbox" style="display:none">
        <div id="prompt" class="prompt"></div>
        <div id="options" class="options"></div>
        <div id="feedback" class="hint"></div>
      </div>

      <div id="result" class="result">
        <h3>æœ¬è½®å®Œæˆ âœ…</h3>
        <div id="summary" class="hint"></div>
        <ol id="missed" class="hint"></ol>
        <div class="footer">
          <button id="retryWrong" type="button">ä»…é‡åšé”™é¢˜</button>
          <button id="restart" class="primary" type="button">é‡æ–°å¼€å§‹</button>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  // å…«å¦â†’ä¸‰çˆ»ï¼ˆè‡ªä¸‹è€Œä¸Š 0=é˜´,1=é˜³ï¼‰æ ‡å‡†æ˜ å°„
  const TRIG = {
    "å¤©":[1,1,1], "æ³½":[1,1,0], "ç«":[1,0,1], "é›·":[1,0,0],
    "é£":[0,1,1], "æ°´":[0,1,0], "å±±":[0,0,1], "åœ°":[0,0,0]
  };

  const TRIG_SYM = {"å¤©":"â˜°","æ³½":"â˜±","ç«":"â˜²","é›·":"â˜³","é£":"â˜´","æ°´":"â˜µ","å±±":"â˜¶","åœ°":"â˜·"};

  const HEXA=[
    {name:"ä¹¾",up:"å¤©",down:"å¤©"},{name:"å¤",up:"åœ°",down:"åœ°"},
    {name:"å±¯",up:"æ°´",down:"é›·"},{name:"è’™",up:"å±±",down:"æ°´"},
    {name:"éœ€",up:"æ°´",down:"å¤©"},{name:"è®¼",up:"å¤©",down:"æ°´"},
    {name:"å¸ˆ",up:"åœ°",down:"æ°´"},{name:"æ¯”",up:"æ°´",down:"åœ°"},
    {name:"å°ç•œ",up:"é£",down:"å¤©"},{name:"å±¥",up:"å¤©",down:"æ³½"},
    {name:"æ³°",up:"åœ°",down:"å¤©"},{name:"å¦",up:"å¤©",down:"åœ°"},
    {name:"åŒäºº",up:"å¤©",down:"ç«"},{name:"å¤§æœ‰",up:"ç«",down:"å¤©"},
    {name:"è°¦",up:"åœ°",down:"å±±"},{name:"è±«",up:"é›·",down:"åœ°"},
    {name:"éš",up:"æ³½",down:"é›·"},{name:"è›Š",up:"å±±",down:"é£"},
    {name:"ä¸´",up:"åœ°",down:"æ³½"},{name:"è§‚",up:"é£",down:"åœ°"},
    {name:"å™¬å—‘",up:"ç«",down:"é›·"},{name:"è´²",up:"å±±",down:"ç«"},
    {name:"å‰¥",up:"å±±",down:"åœ°"},{name:"å¤",up:"åœ°",down:"é›·"},
    {name:"æ— å¦„",up:"å¤©",down:"é›·"},{name:"å¤§ç•œ",up:"å±±",down:"å¤©"},
    {name:"é¢",up:"å±±",down:"é›·"},{name:"å¤§è¿‡",up:"æ³½",down:"é£"},
    {name:"å",up:"æ°´",down:"æ°´"},{name:"ç¦»",up:"ç«",down:"ç«"},
    {name:"å’¸",up:"æ³½",down:"å±±"},{name:"æ’",up:"é›·",down:"é£"},
    {name:"é¯",up:"å¤©",down:"å±±"},{name:"å¤§å£®",up:"é›·",down:"å¤©"},
    {name:"æ™‹",up:"ç«",down:"åœ°"},{name:"æ˜å¤·",up:"åœ°",down:"ç«"},
    {name:"å®¶äºº",up:"é£",down:"ç«"},{name:"ç½",up:"ç«",down:"æ³½"},
    {name:"è¹‡",up:"æ°´",down:"å±±"},{name:"è§£",up:"é›·",down:"æ°´"},
    {name:"æŸ",up:"å±±",down:"æ³½"},{name:"ç›Š",up:"é£",down:"é›·"},
    {name:"å¤¬",up:"æ³½",down:"å¤©"},{name:"å§¤",up:"å¤©",down:"é£"},
    {name:"èƒ",up:"æ³½",down:"åœ°"},{name:"å‡",up:"åœ°",down:"é£"},
    {name:"å›°",up:"æ³½",down:"æ°´"},{name:"äº•",up:"æ°´",down:"é£"},
    {name:"é©",up:"æ³½",down:"ç«"},{name:"é¼",up:"ç«",down:"é£"},
    {name:"éœ‡",up:"é›·",down:"é›·"},{name:"è‰®",up:"å±±",down:"å±±"},
    {name:"æ¸",up:"é£",down:"å±±"},{name:"å½’å¦¹",up:"é›·",down:"æ³½"},
    {name:"ä¸°",up:"é›·",down:"ç«"},{name:"æ—…",up:"ç«",down:"å±±"},
    {name:"å·½",up:"é£",down:"é£"},{name:"å…‘",up:"æ³½",down:"æ³½"},
    {name:"æ¶£",up:"é£",down:"æ°´"},{name:"èŠ‚",up:"æ°´",down:"æ³½"},
    {name:"ä¸­å­š",up:"é£",down:"æ³½"},{name:"å°è¿‡",up:"é›·",down:"å±±"},
    {name:"æ—¢æµ",up:"æ°´",down:"ç«"},{name:"æœªæµ",up:"ç«",down:"æ°´"}
  ];

  function $(id){return document.getElementById(id)}
  const els={
    mode:$('mode'),count:$('count'),start:$('start'),
    hexInPrompt:$('hexInPrompt'),hexAfter:$('hexAfter'),
    qbox:$('qbox'),prompt:$('prompt'),options:$('options'),
    feedback:$('feedback'),result:$('result'),summary:$('summary'),
    missed:$('missed'),prog:$('prog'),bar:$('bar'),
    score:$('score'),acc:$('acc'),restart:$('restart'),
    retryWrong:$('retryWrong')
  };

  function randInt(n){return Math.floor(Math.random()*n)}
  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}

  function trigramLines(name){ return TRIG[name]; }
  function hexLines(up,down){
    // è¿”å›è‡ªä¸‹è€Œä¸Š 6 çˆ»æ•°ç»„ï¼šä¸‹ä¸‰çˆ» + ä¸Šä¸‰çˆ»
    const lo = trigramLines(down); // ä¸‹å¦
    const hi = trigramLines(up);   // ä¸Šå¦
    return [lo[0],lo[1],lo[2],hi[0],hi[1],hi[2]]; // index 0=åˆçˆ»ï¼ˆæœ€ä¸‹ï¼‰
  }
  function hexHTML(up,down){
    const arr = hexLines(up,down);
    // æ¸²æŸ“ä»ä¸Šå¾€ä¸‹ï¼ˆå³ index 5 -> 0ï¼‰
    let html = '<div class="hex" aria-label="å¦å½¢">';
    for(let i=5;i>=0;i--){
      html += `<div class="line ${arr[i]===1?'yang':'yin'}"></div>`;
    }
    html += '</div>';
    return html;
  }

  let questions=[], idx=0, score=0, wrong=[], wrongBackup=[];

  function genQuestions(mode,count){
    const pool = shuffle(HEXA.slice()).slice(0,count);
    return pool.map(item=>{
      const m = mode==="mixed" ? (Math.random()<0.5?"name2pair":"pair2name") : mode;
      if(m==="name2pair"){
        const correct = `ä¸Šå¦ï¼š${item.up}ï¼Œä¸‹å¦ï¼š${item.down}`;
        const ds = new Set();
        while(ds.size<3){
          const a = HEXA[randInt(HEXA.length)], b = HEXA[randInt(HEXA.length)];
          const opt = `ä¸Šå¦ï¼š${a.up}ï¼Œä¸‹å¦ï¼š${b.down}`;
          if(opt!==correct) ds.add(opt);
        }
        const choices = shuffle([correct, ...Array.from(ds)]);
        return {mode:m, item, prompt:`å¦åï¼š${item.name} â†’ è¯·é€‰æ‹©å…¶ä¸Š/ä¸‹å¦`, options:choices, answer:correct};
      }else{
        const correct = item.name;
        const names = new Set();
        while(names.size<3){
          const other = HEXA[randInt(HEXA.length)].name;
          if(other!==correct) names.add(other);
        }
        const choices = shuffle([correct, ...Array.from(names)]);
        return {mode:m, item, prompt:`ä¸Šå¦ï¼š${item.up}ï¼ˆ${TRIG_SYM[item.up]}ï¼‰/ ä¸‹å¦ï¼š${item.down}ï¼ˆ${TRIG_SYM[item.down]}ï¼‰ â†’ è¯·é€‰æ‹©å¦å`, options:choices, answer:correct};
      }
    });
  }

  function updateHUD(){
    els.prog.textContent = `${Math.min(idx,questions.length)}/${questions.length}`;
    els.score.textContent = String(score);
    const acc = questions.length ? Math.round(100*score/Math.max(1, idx)) : 0;
    els.acc.textContent = `${isNaN(acc)?0:acc}%`;
    els.bar.style.width = `${questions.length?(100*idx/questions.length):0}%`;
  }
  function clear(node){while(node.firstChild) node.removeChild(node.firstChild);}

  function renderQuestion(){
    els.result.style.display='none';
    els.qbox.style.display='block';
    clear(els.options);
    els.feedback.innerHTML='';
    const q = questions[idx];

    // é¢˜å¹²
    if(q.mode==='pair2name' && els.hexInPrompt.checked){
      els.prompt.innerHTML = q.prompt + `<div class="hexwrap"><div class="hexlabel">å¦å½¢ï¼š</div>${hexHTML(q.item.up, q.item.down)}<div class="hexlabel">ï¼ˆä¸Šï¼š${q.item.up} ${TRIG_SYM[q.item.up]} / ä¸‹ï¼š${q.item.down} ${TRIG_SYM[q.item.down]}ï¼‰</div></div>`;
    }else{
      els.prompt.innerHTML = q.prompt;
    }

    // é€‰é¡¹
    q.options.forEach(text=>{
      const btn = document.createElement('button');
      btn.type='button'; btn.className='opt'; btn.textContent=text;
      btn.onclick = () => {
        document.querySelectorAll('.opt').forEach(b=>b.disabled=true);
        const correct = (text===q.answer);
        if(correct){
          btn.classList.add('correct');
          score++;
        }else{
          btn.classList.add('incorrect');
          // é«˜äº®æ­£ç¡®é¡¹
          document.querySelectorAll('.opt').forEach(b=>{ if(b.textContent===q.answer) b.classList.add('correct'); });
          wrong.push(q);
        }
        // ç­”é¢˜åæç¤º & å¦å½¢
        if(els.hexAfter.checked){
          const tip = (q.mode==='name2pair')
            ? `${q.item.name} = ä¸Šå¦ã€Œ${q.item.up}ã€/ ä¸‹å¦ã€Œ${q.item.down}ã€`
            : `ä¸Šå¦ã€Œ${q.item.up}ã€/ ä¸‹å¦ã€Œ${q.item.down}ã€ = ã€Œ${q.item.name}ã€`;
          els.feedback.innerHTML = `<div>${correct?'æ­£ç¡® âœ…':'å†è®°ä¸€é ğŸ™Œ'}ï¼š${tip}</div><div class="hexwrap"><div class="hexlabel">å¦å½¢ï¼š</div>${hexHTML(q.item.up,q.item.down)}</div>`;
        }else{
          els.feedback.textContent = correct ? 'æ­£ç¡® âœ…' : 'å†è®°ä¸€é ğŸ™Œ';
        }

        idx++; updateHUD();
        setTimeout(nextStep, 650);
      };
      els.options.appendChild(btn);
    });
    updateHUD();
  }

  function nextStep(){ if(idx>=questions.length) showResult(); else renderQuestion(); }

  function showResult(){
    els.qbox.style.display='none'; els.result.style.display='block';
    const acc = Math.round(100*score/questions.length);
    els.summary.innerHTML = `æœ¬è½®å…± ${questions.length} é¢˜ï¼Œå¾—åˆ† <b>${score}</b>ï¼Œæ­£ç¡®ç‡ <b>${acc}%</b>ã€‚`;
    clear(els.missed);
    if(!wrong.length){
      const li=document.createElement('li'); li.textContent='æ²¡æœ‰é”™é¢˜ï¼Œå¤ªæ£’äº†ï¼'; els.missed.appendChild(li);
    }else{
      const seen=new Set();
      wrong.forEach(q=>{
        const key = q.item.name+'|'+q.item.up+'|'+q.item.down+'|'+q.mode;
        if(seen.has(key)) return; seen.add(key);
        const li=document.createElement('li');
        li.innerHTML = (q.mode==='name2pair')
          ? `${q.item.name} â†’ ä¸Šå¦ã€Œ${q.item.up}ã€/ ä¸‹å¦ã€Œ${q.item.down}ã€ ${hexHTML(q.item.up,q.item.down)}`
          : `ä¸Šå¦ã€Œ${q.item.up}ã€/ ä¸‹å¦ã€Œ${q.item.down}ã€ â†’ ã€Œ${q.item.name}ã€ ${hexHTML(q.item.up,q.item.down)}`;
        els.missed.appendChild(li);
      });
    }
    wrongBackup = wrong.slice();
  }

  function startQuiz(fromWrong){
    const mode = els.mode.value;
    const count = parseInt(els.count.value,10)||10;
    idx=0; score=0; wrong=[];
    if(fromWrong && wrongBackup.length){
      questions = shuffle(wrongBackup.slice());
    }else{
      questions = genQuestions(mode, count);
    }
    els.result.style.display='none';
    renderQuestion();
  }

  // å…œåº•å¯åŠ¨ï¼ˆé¿å…ç§»åŠ¨ç«¯äº‹ä»¶ç»‘å®šå¤±è´¥ï¼‰
  window._forceStart = function(){ try{ startQuiz(false); }catch(e){ alert('å¯åŠ¨å¤±è´¥ï¼š'+e.message); } };
  if(els.start) els.start.addEventListener('click', ()=> window._forceStart());
  if(els.restart) els.restart.addEventListener('click', ()=> window._forceStart());
  if(els.retryWrong) els.retryWrong.addEventListener('click', ()=>{
    if(!wrongBackup.length){ alert('æœ¬è½®æ²¡æœ‰é”™é¢˜ï¼Œå…ˆåšä¸€è½®å®Œæ•´æµ‹éªŒå§ã€‚'); return; }
    startQuiz(true);
  });
})();
</script>
</body>
</html>
